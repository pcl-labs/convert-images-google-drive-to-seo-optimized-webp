<section class="space-y-4" id="project-sections" data-project-id="{{ project.project_id }}">
  <header class="flex items-center justify-between gap-2 border-b border-border/60 pb-1">
    <nav class="flex items-center gap-4 text-xs font-medium" aria-label="Section view">
      <button
        type="button"
        class="pb-1 border-b-2 border-primary text-primary"
        data-sections-tab="summary"
        aria-selected="true"
      >
        Summary
      </button>
      <button
        type="button"
        class="pb-1 border-b-2 border-transparent text-contentMuted"
        data-sections-tab="detail"
        aria-selected="false"
      >
        Full diff
      </button>
    </nav>
    <p class="text-[11px] text-contentMuted" id="section-count-label">
      {% if sections %}
        {{ sections|length }} sections
      {% else %}
        No sections
      {% endif %}
    </p>
  </header>

  <div class="space-y-4" aria-labelledby="section-count-label">
    {# Summary list view #}
    <div data-sections-panel="summary">
      {% if sections %}
        <ul class="divide-y divide-border/60 rounded-lg border border-border bg-surface/80 overflow-hidden">
          {% for s in sections %}
            <li>
              <button
                type="button"
                class="w-full flex items-center justify-between gap-3 px-3 py-2 text-left hover:bg-surfaceMuted/70 focus:outline-none focus:bg-surfaceMuted/70"
                data-action="select-section"
                data-section-id="{{ s.section_id }}"
                data-section-index="{{ s.index }}"
                data-section-title="{{ s.title or 'Untitled section' }}"
                data-section-words="{{ s.word_count or 0 }}"
                data-section-preview="{{ (s.body_preview or s.summary or 'No content yet.')|replace('\n', ' ') }}"
              >
                <div class="min-w-0 flex-1">
                  <p class="text-[11px] uppercase tracking-wide text-contentMuted">
                    Section {{ s.index + 1 }}
                  </p>
                  <p class="text-sm font-medium text-content truncate">
                    {{ s.title or "Untitled section" }}
                  </p>
                  <p class="mt-0.5 text-[11px] text-contentMuted line-clamp-1">
                    {{ s.body_preview or s.summary or "No content yet." }}
                  </p>
                </div>
                <div class="flex items-center gap-2 text-[11px] text-contentMuted">
                  <span>{{ s.word_count or 0 }} words</span>
                  <span class="h-4 w-[1px] bg-border/60"></span>
                  <span aria-hidden="true" class="text-lg leading-none">â€º</span>
                </div>
              </button>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="rounded-md border border-dashed border-border bg-surface/40 p-4 text-sm text-contentMuted">
          No sections yet. Generate a blog for this project first.
        </div>
      {% endif %}
    </div>

    {# Detail / Full diff view #}
    <div class="space-y-3 hidden" data-sections-panel="detail" aria-live="polite">
      <div class="flex items-center justify-between gap-2">
        <div class="min-w-0">
          <p class="text-[11px] uppercase tracking-wide text-contentMuted" id="section-detail-index">
            Section 1
          </p>
          <h2 class="text-sm font-medium text-content truncate" id="section-detail-title">
            {{ sections[0].title if sections else 'Select a section' }}
          </h2>
          <p class="text-[11px] text-contentMuted" id="section-detail-meta">
            {% if sections %}
              {{ sections[0].word_count or 0 }} words
            {% else %}
              No section selected
            {% endif %}
          </p>
        </div>
        <button
          type="button"
          class="btn-ghost text-xs px-3 py-1"
          data-action="back-to-summary"
        >
          Back to summary
        </button>
      </div>

      <div class="rounded-lg border border-border bg-surface/80 p-3 text-xs font-mono text-content max-h-80 overflow-auto" id="section-detail-body">
        {% if sections %}
          {{ sections[0].body_preview or sections[0].summary or "No content yet." }}
        {% else %}
          Select a section from the Summary tab to view its content.
        {% endif %}
      </div>

      <div class="flex justify-end">
        <button
          type="button"
          class="btn-primary text-xs"
          data-action="open-ask-changes"
          {% if not sections %}disabled aria-disabled="true"{% endif %}
        >
          Ask for changes
        </button>
      </div>
    </div>
  </div>

  {# Ask-for-changes modal sheet #}
  <div
    id="section-ask-changes-modal"
    class="fixed inset-0 z-40 hidden items-end justify-center bg-black/40"
    role="dialog"
    aria-modal="true"
    aria-labelledby="ask-changes-title"
  >
    <div class="w-full max-w-xl rounded-t-2xl border border-border bg-surface px-4 pt-3 pb-4 shadow-xl">
      <header class="flex items-center justify-between gap-2 mb-2">
        <div class="min-w-0">
          <p id="ask-changes-title" class="text-xs font-medium uppercase tracking-wide text-contentMuted">
            Ask for changes
          </p>
          <p id="ask-changes-section-label" class="text-sm font-medium text-content truncate">
            Section
          </p>
        </div>
        <button
          type="button"
          class="btn-ghost text-xs px-2 py-1"
          data-action="close-ask-changes"
        >
          Cancel
        </button>
      </header>

      <div class="space-y-2">
        <label for="ask-changes-textarea" class="sr-only">Describe the changes you want</label>
        <textarea
          id="ask-changes-textarea"
          class="field w-full resize-y text-sm"
          rows="4"
          placeholder="Describe the changes you want to this section..."
        ></textarea>
        <div class="flex justify-end gap-2">
          <button
            type="button"
            class="btn-primary text-xs"
            data-action="submit-ask-changes"
          >
            Apply with AI
          </button>
        </div>
      </div>
    </div>
  </div>
</section>
