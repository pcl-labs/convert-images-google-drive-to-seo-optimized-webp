{% set latest_gen = document.latest_generation %}
{% set latest_job = jobs[0] if jobs and jobs|length > 0 else None %}
{% set has_outline = document.latest_outline and document.latest_outline|length > 0 %}
{% set has_raw = document.raw_text and document.raw_text|length > 0 %}

<div class="space-y-4 text-sm">
  <div class="space-y-1">
    <p class="text-xs uppercase tracking-wide text-contentMuted">Step 1 · Source text</p>
    {% if has_raw %}
      <p class="text-content whitespace-pre-wrap break-words">{{ document.raw_text }}</p>
      <p class="text-xs text-contentMuted mt-1">Length: ~{{ document.raw_text|length }} characters.</p>
    {% else %}
      <p class="text-xs text-contentMuted">No raw text stored for this document.</p>
    {% endif %}
  </div>

  <div class="border-t border-border/60 pt-3 space-y-1">
    <p class="text-xs uppercase tracking-wide text-contentMuted">Step 2 · Heuristic outline</p>
    {% if has_outline %}
      <ol class="space-y-2">
        {% for item in document.latest_outline %}
          <li class="rounded-lg bg-surfaceMuted/60 p-2">
            <div class="font-semibold text-content">{{ item.title or ('Section ' ~ (loop.index)) }}</div>
            {% if item.summary %}
              <p class="text-xs text-contentMuted mt-1">{{ item.summary }}</p>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="text-xs text-contentMuted">Outline will appear here once the pipeline runs.</p>
    {% endif %}
  </div>

  <div class="border-t border-border/60 pt-3 space-y-1">
    <p class="text-xs uppercase tracking-wide text-contentMuted">Step 3 · SEO + chapters</p>
    {% set seo = document.latest_generation.meta if latest_gen and latest_gen.meta else None %}
    {% if seo %}
      <div class="space-y-2">
        {% if seo.title %}
          <p class="text-content"><span class="font-semibold">Title:</span> {{ seo.title }}</p>
        {% endif %}
        {% if seo.description %}
          <p class="text-xs text-contentMuted"><span class="font-semibold">Description:</span> {{ seo.description }}</p>
        {% endif %}
        {% if seo.keywords %}
          <div class="flex flex-wrap gap-1 text-[11px] text-contentMuted">
            {% for kw in seo.keywords %}
              <span class="rounded-full border border-border px-2 py-[2px]">{{ kw }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% else %}
      <p class="text-xs text-contentMuted">SEO/chapter metadata will appear here once a blog draft has been generated.</p>
    {% endif %}
  </div>

  <div class="border-t border-border/60 pt-3 space-y-1">
    <p class="text-xs uppercase tracking-wide text-contentMuted">Step 4 · Gateway compose</p>
    {% if latest_gen %}
      <p class="text-content">
        {{ latest_gen.engine|default('AI')|title }}{% if latest_gen.model %} · {{ latest_gen.model }}{% endif %}
        {% if latest_gen.word_count %} · {{ latest_gen.word_count }} words{% endif %}
      </p>
      {% if latest_gen.generated_at %}
        <p class="text-xs text-contentMuted">Generated {{ latest_gen.generated_at }}</p>
      {% endif %}
    {% else %}
      <p class="text-xs text-contentMuted">No generated draft yet. Run the blog generator to see this step.</p>
    {% endif %}
  </div>

  <div class="border-t border-border/60 pt-3 space-y-1">
    <p class="text-xs uppercase tracking-wide text-contentMuted">Step 5 · Job + API links</p>
    {% if latest_job %}
      <p class="text-content">Latest job: {{ latest_job.kind }} · {{ latest_job.status_label }}</p>
      <p class="text-xs text-contentMuted">Created {{ latest_job.created_at or 'unknown' }}</p>
    {% else %}
      <p class="text-xs text-contentMuted">No jobs yet for this document.</p>
    {% endif %}
  </div>

  <div class="border-t border-border/60 pt-3 space-y-1">
    <p class="text-xs uppercase tracking-wide text-contentMuted">Debug · Pipeline state JSON</p>
    <div class="space-y-2 text-[11px] font-mono bg-card border border-border rounded-lg p-3 overflow-auto">
      <div>
        <p class="text-contentMuted mb-1">latest_generation</p>
        <pre class="whitespace-pre-wrap break-words">{{ document.latest_generation | tojson(indent=2) }}</pre>
      </div>
      <div>
        <p class="text-contentMuted mb-1">latest_outline</p>
        <pre class="whitespace-pre-wrap break-words">{{ document.latest_outline | tojson(indent=2) }}</pre>
      </div>
      <div>
        <p class="text-contentMuted mb-1">latest_job</p>
        <pre class="whitespace-pre-wrap break-words">{{ latest_job | tojson(indent=2) }}</pre>
      </div>
    </div>
  </div>
</div>
