<aside x-data="{ open: false }" class="">
  {% from 'components/elements/icon.html' import icon %}
  {% macro nav_links(path) %}
    {% set path_parts = path.split('/') %}
    {% set section = path_parts[2] if path_parts|length > 2 and path.startswith('/dashboard') else '' %}
    <a href="/dashboard" class="flex items-center gap-2 px-3 py-2 rounded-md {{ 'bg-surfaceMuted text-content' if path == '/dashboard' else 'text-content hover:bg-surfaceMuted' }}">Dashboard</a>
    <a href="/dashboard/documents" class="flex items-center gap-2 px-3 py-2 rounded-md {{ 'bg-surfaceMuted text-content' if section == 'documents' else 'text-content hover:bg-surfaceMuted' }}">Documents</a>
    <a href="/dashboard/integrations" class="flex items-center gap-2 px-3 py-2 rounded-md {{ 'bg-surfaceMuted text-content' if section == 'integrations' else 'text-content hover:bg-surfaceMuted' }}">Integrations</a>
    <a href="/dashboard/account" class="flex items-center gap-2 px-3 py-2 rounded-md {{ 'bg-surfaceMuted text-content' if section == 'account' else 'text-content hover:bg-surfaceMuted' }}">Account</a>
    <a href="/dashboard/settings" class="flex items-center gap-2 px-3 py-2 rounded-md {{ 'bg-surfaceMuted text-content' if section == 'settings' else 'text-content hover:bg-surfaceMuted' }}">Settings</a>
  {% endmacro %}
  <div class="lg:hidden">
    <!-- Mobile header bar with menu button only -->
    <div class="sticky top-0 z-30 h-14 flex items-center justify-start px-3 bg-bg/80 border-b border-border backdrop-blur">
      <button @click="open = true" aria-label="Open menu" class="inline-flex items-center rounded-md bg-surfaceMuted/80 border border-border px-3 py-2 text-content hover:bg-surfaceMuted">
        {{ icon('menu', size='h-5 w-5') }}
        <span class="ml-2 text-sm">Menu</span>
      </button>
    </div>
    <div x-show="open" x-transition.opacity class="fixed inset-0 z-40 bg-black/50" @click="open=false"></div>
    <div x-show="open" x-transition class="fixed inset-y-0 left-0 z-50 w-64 bg-surfaceMuted border-r border-border p-4">
      <div class="flex items-center justify-between mb-4">
        <div class="text-content font-semibold">Quill</div>
        <button @click="open=false" aria-label="Close menu" class="text-contentMuted hover:text-content">
          {{ icon('close', size='h-5 w-5') }}
        </button>
      </div>
      <nav class="space-y-1">
        {% set path = request.url.path %}
        {{ nav_links(path) }}
      </nav>
    </div>
  </div>

  {% set state_user = request.state|attr('user') if request.state is defined else None %}
  {% set sidebar_user = state_user if state_user else user %}
  {% set sidebar_email = sidebar_user.email if sidebar_user and sidebar_user.email else (user.email if user else None) %}
  <div class="hidden lg:flex lg:flex-col lg:w-64 lg:fixed lg:inset-y-0 bg-bg border-r border-border">
    <div class="h-14 flex items-center px-4 border-b border-border">
      <div class="flex items-center gap-2">
        <span class="text-content font-semibold">Quill</span>
      </div>
    </div>
    <nav class="flex-1 p-3 space-y-1">
      {% set path = request.url.path %}
      {{ nav_links(path) }}
    </nav>
    <!-- Desktop footer -->
    <div class="p-3 border-t border-border">
      <a href="/dashboard/account" class="block w-full">
        <div class="h-12 px-3 rounded-md flex items-center gap-3 text-contentMuted hover:bg-surfaceMuted/60">
          {{ icon('email', size='h-5 w-5', class='text-contentMuted') }}
          <span class="text-sm truncate">{{ sidebar_email or 'Account' }}</span>
        </div>
      </a>
    </div>
  </div>
</aside>
