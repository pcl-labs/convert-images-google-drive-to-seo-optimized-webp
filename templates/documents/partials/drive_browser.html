{% from 'components/elements/card.html' import card %}
{% set overview = drive_sync_overview %}
{% set manage_link = '<a href="/dashboard/integrations/drive" class="text-xs text-primary hover:text-primary/80">Manage integration</a>' %}
{% call card(title='Drive workspace', actions=manage_link) %}
  <div class="space-y-6">
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div>
        <p class="text-sm font-semibold text-content">{{ overview.status_label }}</p>
        <p class="text-xs text-contentMuted">
          {% if overview.last_synced_at %}
            Last synced {{ overview.last_synced_at }}
          {% elif overview.connected %}
            Drive workspace not synced yet.
          {% else %}
            Connect Google Drive to create your workspace.
          {% endif %}
        </p>
      </div>
      <div class="text-right">
        <p class="text-2xl font-semibold text-content">{{ overview.document_count }}</p>
        <p class="text-xs text-contentMuted">Drive documents</p>
      </div>
    </div>

    {% if overview.folders %}
      <div class="grid gap-3 md:grid-cols-3">
        {% for folder in overview.folders %}
          <div class="rounded-lg border border-border p-3 bg-surface/40">
            <p class="text-xs uppercase tracking-wide text-contentMuted">{{ folder.label }}</p>
            <p class="text-sm font-semibold text-content mt-1">{{ folder.name or folder.id or 'Untitled' }}</p>
            <p class="text-xs text-contentMuted">ID: {{ folder.id or 'â€”' }}</p>
            {% if folder.link %}
              <a href="{{ folder.link }}" target="_blank" rel="noopener" class="text-xs text-primary hover:text-primary/80 mt-1 inline-flex items-center gap-1">Open in Drive</a>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="space-y-2">
      <div class="flex items-center justify-between">
        <p class="text-xs uppercase tracking-wide text-contentMuted">Recent Drive documents</p>
        {% if overview.document_count > 0 %}
          <a href="/dashboard/documents" class="text-xs text-primary hover:text-primary/80">View all</a>
        {% endif %}
      </div>
      {% if overview.documents %}
        <div class="space-y-3">
          {% for doc in overview.documents %}
            <article class="rounded-lg border border-border p-3 bg-surface/40 text-sm">
              <div class="flex flex-col gap-1 md:flex-row md:items-center md:justify-between">
                <div>
                  <p class="text-xs uppercase tracking-wide text-contentMuted">{{ doc.source_label }}</p>
                  <p class="text-content font-semibold">{{ doc.title or doc.document_id }}</p>
                </div>
                <div class="flex flex-wrap gap-2 text-xs">
                  {% if doc.drive.folder_link %}
                    <a href="{{ doc.drive.folder_link }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border text-primary hover:text-primary/80">Workspace</a>
                  {% endif %}
                  {% if doc.drive.draft_link %}
                    <a href="{{ doc.drive.draft_link }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border text-primary hover:text-primary/80">Draft Doc</a>
                  {% endif %}
                  <a href="/dashboard/documents/{{ doc.document_id }}" class="inline-flex items-center px-2 py-1 rounded-md border border-border hover:bg-surface/60">View in Quill</a>
                </div>
              </div>
              <div class="mt-2 flex flex-wrap gap-2 text-xs text-contentMuted">
                {% if doc.drive.media_link %}
                  <a href="{{ doc.drive.media_link }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border hover:border-primary hover:text-primary">Media</a>
                {% endif %}
                {% if doc.drive.published_link %}
                  <a href="{{ doc.drive.published_link }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border hover:border-primary hover:text-primary">Published</a>
                {% endif %}
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-sm text-contentMuted">No Drive documents yet. Link a folder to initialize the workspace.</p>
      {% endif %}
    </div>
  </div>
{% endcall %}
