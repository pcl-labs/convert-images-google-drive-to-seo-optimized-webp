<div id="documents-table" class="space-y-3">
  {% if flash %}
    {% from 'components/elements/alert.html' import alert %}
    <div>
      {{ alert(kind='success' if flash.status == 'success' else 'error', text=flash.message, dismissible=True) }}
    </div>
  {% endif %}
  {% for document in documents %}
    {% set drive_meta = document.metadata.drive if document.metadata and document.metadata.get('drive') else {} %}
    {% set folder = drive_meta.folder or {} %}
    {% set drafts = drive_meta.drafts or {} %}
    {% set media = drive_meta.media or {} %}
    {% set published = drive_meta.published or {} %}
    <article class="surface rounded-lg p-4 space-y-4">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div>
          <p class="text-xs uppercase tracking-wide text-contentMuted">{{ document.source_label }}</p>
          <a href="/dashboard/documents/{{ document.id }}" class="text-base font-semibold text-primary hover:text-primary/80 break-all">
            {{ document.frontmatter.title or document.metadata.title or document.id }}
          </a>
          <p class="text-xs text-contentMuted break-all">Document ID: {{ document.id }}</p>
        </div>
        <div class="text-xs text-contentMuted md:text-right">
          <p>Created {{ document.created_at or '—' }}</p>
        </div>
      </div>
      <div class="grid gap-4 text-sm text-content sm:grid-cols-3">
        <div class="space-y-1 text-contentMuted">
          <p class="text-xs uppercase tracking-wide">Origin</p>
          <p class="break-all">{{ document.origin or '—' }}</p>
        </div>
        <div class="space-y-1">
          <p class="text-xs uppercase tracking-wide text-contentMuted">Drive workspace</p>
          {% if folder.webViewLink %}
            <a href="{{ folder.webViewLink }}" target="_blank" rel="noopener" class="text-primary hover:text-primary/80">
              {{ folder.name or document.drive_folder_id or 'Open folder' }}
            </a>
            <p class="text-xs text-contentMuted">ID: {{ folder.id or document.drive_folder_id or '—' }}</p>
          {% elif document.drive_folder_id %}
            <p class="break-all">{{ document.drive_folder_id }}</p>
          {% else %}
            <p class="text-contentMuted">No Drive folder linked</p>
          {% endif %}
        </div>
        <div class="space-y-2">
          <p class="text-xs uppercase tracking-wide text-contentMuted">Drive assets</p>
          <div class="flex flex-wrap gap-2 text-xs">
            {% if drafts.webViewLink or drive_meta.web_view_link %}
              <a href="{{ drafts.webViewLink or drive_meta.web_view_link }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border hover:border-primary hover:text-primary">Draft Doc</a>
            {% endif %}
            {% if media.webViewLink %}
              <a href="{{ media.webViewLink }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border hover:border-primary hover:text-primary">Media</a>
            {% endif %}
            {% if published.webViewLink %}
              <a href="{{ published.webViewLink }}" target="_blank" rel="noopener" class="inline-flex items-center px-2 py-1 rounded-md border border-border hover:border-primary hover:text-primary">Published</a>
            {% endif %}
            {% if not (drafts or media or published) %}
              <span class="text-contentMuted">No Drive assets yet</span>
            {% endif %}
          </div>
        </div>
      </div>
    </article>
  {% else %}
    <div class="surface rounded-lg p-6 text-center text-sm text-contentMuted">No documents yet</div>
  {% endfor %}
</div>
