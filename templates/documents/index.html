{% extends "base.html" %}
{% set page_title = 'Documents' %}
{% from 'components/elements/input.html' import input %}
{% from 'components/elements/button.html' import button %}
{% from 'components/layout/page.html' import page_container, page_header %}
{% block content %}
{% call page_container() %}
  {{ page_header('Documents', 'Register sources and ingest content into document IDs.') }}

  {% if drive_sync_overview %}
    {% include 'documents/partials/drive_browser.html' %}
  {% endif %}

  <div class="grid gap-4 lg:grid-cols-3">
    {% from 'components/elements/card.html' import card %}
    {% call card() %}
      <div class="flex items-center justify-between mb-3">
        <div>
          <div class="text-content font-semibold text-sm">Link Drive Folder</div>
          <p class="text-xs text-contentMuted">Requires Google integration</p>
        </div>
        {% if drive_connected %}
          {% from 'components/elements/badge.html' import badge %}
          {{ badge('Connected', status='completed') }}
        {% else %}
          <a href="/auth/google/start?integration=drive&redirect=/dashboard/documents" class="text-xs text-primary hover:text-primary/80">Connect Google</a>
        {% endif %}
      </div>
      <form class="space-y-3" hx-post="/dashboard/documents/drive" hx-target="#documents-table" hx-swap="outerHTML">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        {{ input('drive_source', label='Drive folder link or ID', placeholder='https://drive.google.com/drive/folders/...', attrs='required' + (' disabled' if not drive_connected else '')) }}
        {{ button('Register Document', variant='primary', attrs='type="submit" class="w-full"' + (' disabled' if not drive_connected else '')) }}
      </form>
    {% endcall %}

    {% call card() %}
      <div class="flex items-center justify-between mb-3">
        <div>
          <div class="text-content font-semibold text-sm">Ingest YouTube Video</div>
          <p class="text-xs text-contentMuted">Requires YouTube integration</p>
        </div>
        {% if youtube_connected %}
          {% from 'components/elements/badge.html' import badge %}
          {{ badge('Connected', status='completed') }}
        {% else %}
          <a href="/auth/google/start?integration=youtube&redirect=/dashboard/documents" class="text-xs text-primary hover:text-primary/80">Connect YouTube</a>
        {% endif %}
      </div>
      <form class="space-y-3" hx-post="/dashboard/documents/youtube" hx-target="#documents-table" hx-swap="outerHTML">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        {{ input('youtube_url', label='YouTube URL', type='url', placeholder='https://www.youtube.com/watch?v=...', attrs='required' + (' disabled' if not youtube_connected else '')) }}
        {{ button('Queue Transcript & Chapters', variant='primary', attrs='type="submit" class="w-full"' + (' disabled' if not youtube_connected else '')) }}
      </form>
    {% endcall %}

    {% call card() %}
      <div class="text-content font-semibold text-sm mb-3">Paste Raw Text</div>
      <form class="space-y-3" hx-post="/dashboard/documents/text" hx-target="#documents-table" hx-swap="outerHTML">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        {{ input('title', label='Title (optional)', placeholder='My interview notes') }}
        <div class="space-y-1">
          <label for="text_body" class="text-sm text-contentMuted">Text</label>
          <textarea id="text_body" name="text_body" rows="5" class="field w-full rounded-lg" placeholder="Paste article, transcript, or outline..." required></textarea>
        </div>
        {{ button('Create Document', variant='primary', attrs='type="submit" class="w-full"') }}
      </form>
    {% endcall %}
  </div>

  {% call card(title='All Documents', actions='<p class="text-xs text-contentMuted">' ~ total_documents ~ ' total</p><p class="text-xs text-contentMuted">Use Document IDs when scheduling optimization or blog generation jobs.</p>') %}
    {% include "documents/partials/list.html" %}
  {% endcall %}
{% endcall %}
{% endblock %}
