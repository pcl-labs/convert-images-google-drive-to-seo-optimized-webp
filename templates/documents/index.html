{% extends "base.html" %}
{% set page_title = 'Documents' %}
{% from 'components/elements/input.html' import input %}
{% from 'components/elements/button.html' import button %}
{% block content %}
<div class="p-4 md:p-6 space-y-6">
  <div class="space-y-1">
    <h1 class="text-xl font-semibold text-content">Documents</h1>
    <p class="text-sm text-contentMuted">Register sources and ingest content into document IDs.</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    {% from 'components/elements/card.html' import card %}
    {% call card() %}
      <div class="flex items-center justify-between mb-3">
        <div>
          <div class="text-content font-semibold text-sm">Link Drive Folder</div>
          <p class="text-xs text-contentMuted">Requires Google integration</p>
        </div>
        {% if google_connected %}
          {% from 'components/elements/badge.html' import badge %}
          {{ badge('Connected', status='completed') }}
        {% else %}
          <a href="/auth/google/start" class="text-xs text-primary hover:text-primary/80">Connect Google</a>
        {% endif %}
      </div>
      <form class="space-y-3" hx-post="/dashboard/documents/drive" hx-target="#documents-table" hx-swap="outerHTML">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        {% from 'components/elements/input.html' import input %}
        {{ input('drive_source', label='Drive folder link or ID', placeholder='https://drive.google.com/drive/folders/...', attrs='required' + (' disabled' if not google_connected else '')) }}
        {% from 'components/elements/button.html' import button %}
        {{ button('Register Document', variant='primary', attrs='type="submit" class="w-full"' + (' disabled' if not google_connected else '')) }}
      </form>
    {% endcall %}

    {% call card() %}
      <div class="text-content font-semibold text-sm mb-3">Ingest YouTube Video</div>
      <form class="space-y-3" hx-post="/dashboard/documents/youtube" hx-target="#documents-table" hx-swap="outerHTML">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        {{ input('youtube_url', label='YouTube URL', type='url', placeholder='https://www.youtube.com/watch?v=...', attrs='required') }}
        {{ button('Queue Transcript & Chapters', variant='primary', attrs='type="submit" class="w-full"') }}
      </form>
    {% endcall %}

    {% call card() %}
      <div class="text-content font-semibold text-sm mb-3">Paste Raw Text</div>
      <form class="space-y-3" hx-post="/dashboard/documents/text" hx-target="#documents-table" hx-swap="outerHTML">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        {{ input('title', label='Title (optional)', placeholder='My interview notes') }}
      <div class="space-y-1">
        <label for="text_body" class="text-sm text-contentMuted">Text</label>
        <textarea id="text_body" name="text_body" rows="5" class="field w-full rounded-lg" placeholder="Paste article, transcript, or outline..." required></textarea>
      </div>
      {{ button('Create Document', variant='primary', attrs='type="submit" class="w-full"') }}
    </form>
  {% endcall %}
  </div>

  {% call card(title='All Documents', actions='<p class="text-xs text-contentMuted">' ~ total_documents ~ ' total</p><p class="text-xs text-contentMuted">Use Document IDs when scheduling optimization or blog generation jobs.</p>') %}
    {% include "documents/partials/list.html" %}
  {% endcall %}
</div>
{% endblock %}
