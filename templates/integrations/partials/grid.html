{% from 'components/elements/integration_card.html' import integration_card %}
{% from 'components/elements/integration_icon.html' import integration_icon %}

<div class="space-y-8" id="integrations-grid-inner">
  <section class="space-y-3">
    <div>
      <h2 class="text-sm font-semibold text-content">Enabled apps</h2>
      <p class="text-sm text-contentMuted">The apps and connectors you've enabled appear here. Quill can use them in your conversations, based on the permissions you've granted.</p>
    </div>
    <div class="space-y-3">
      {% set ns = namespace(any_connected=false) %}
      {% for key, s in services_meta.items() %}
        {% set data = integrations.get(key) %}
        {% if data and data.connected %}
          {% set ns.any_connected = true %}
          {% set card = {
            'key': s.key,
            'name': s.name,
            'subtitle': s.capability,
            'description': s.description
          } %}
          {{ integration_card(card, data, csrf_token) }}
        {% endif %}
      {% endfor %}
      {% if not ns.any_connected %}
        <div class="text-sm text-contentMuted">No apps enabled yet.</div>
      {% endif %}
    </div>
  </section>

  <section class="space-y-3">
    <div>
      <h2 class="text-sm font-semibold text-content">Browse apps</h2>
      <p class="text-sm text-contentMuted">Connect apps so you can talk to them with visual and interactive experiences in Quill. Learn more.</p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
      {% for key, s in services_meta.items() %}
        {% set data = integrations.get(key) %}
        {% if not (data and data.connected) %}
          <a href="/dashboard/integrations/{{ s.key }}" class="surface rounded-md p-4 hover:bg-surfaceMuted/50 transition-colors flex items-center gap-3">
            <div class="h-10 w-10 rounded-md bg-surfaceMuted border border-border p-2.5">
              {{ integration_icon(s.key) }}
            </div>
            <div class="min-w-0">
              <div class="text-content font-medium truncate">{{ s.name }}</div>
              <div class="text-xs text-contentMuted truncate">{{ s.capability }}</div>
            </div>
          </a>
        {% endif %}
      {% endfor %}
    </div>
  </section>
</div>
