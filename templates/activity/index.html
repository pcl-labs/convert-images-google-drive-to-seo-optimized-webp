{% extends "base.html" %}
{% set page_title = 'Activity' %}
{% from 'components/layout/page.html' import page_container, page_header %}
{% block content %}
{% call page_container() %}
  {{ page_header('Activity', 'Recent notifications') }}

  <div class="space-y-2">
    {% from 'components/elements/alert.html' import alert %}
    {% from 'components/elements/button.html' import button %}
    {% if notifications and notifications|length > 0 %}
      {% for n in notifications %}
        {% set level = n.level or 'info' %}
        <div class="space-y-3 surface rounded-lg p-4">
          {{ alert('success' if level=='success' else ('error' if level=='error' else 'info'), n.text) }}
          <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end">
            {{ button('Seen', variant='ghost', attrs='hx-post="/api/notifications/' ~ n.id ~ '/seen" hx-headers=\'{"X-CSRF-Token":"{{ csrf_token }}"}\' hx-swap="none" hx-on:htmx:afterOnLoad="window.dispatchEvent(new CustomEvent(\'toast\',{detail:{type:\'info\',text:\'Marked seen\'}}))"', with_spinner=True) }}
            {{ button('Dismiss', variant='ghost', attrs='hx-post="/api/notifications/' ~ n.id ~ '/dismiss" hx-headers=\'{"X-CSRF-Token":"{{ csrf_token }}"}\' hx-swap="none" hx-on:htmx:afterOnLoad="window.dispatchEvent(new CustomEvent(\'toast\',{detail:{type:\'info\',text:\'Dismissed\'}}))"', with_spinner=True) }}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="text-contentMuted text-sm">No notifications yet.</div>
    {% endif %}
  </div>
{% endcall %}
{% endblock %}
