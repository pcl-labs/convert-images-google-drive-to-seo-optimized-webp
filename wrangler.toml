# Cloudflare Workers configuration

name = "quill-api"
main = "workers/main.py"
compatibility_date = "2024-01-01"
compatibility_flags = ["python_workers"]

# Python runtime
[build]
command = "pip install -r cf-requirements.txt"

# Environment variables
[vars]
ENVIRONMENT = "production"
DEBUG = "false"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "quill-db"
database_id = "933d76cf-a988-4a71-acc6-d884278c6402"

# Queue binding
[[queues.producers]]
queue = "quill-jobs"
binding = "JOB_QUEUE"

[[queues.consumers]]
queue = "quill-jobs"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "quill-dlq"

# Dead letter queue
[[queues.producers]]
queue = "quill-dlq"
binding = "DLQ"

# Secrets (set via wrangler secret put)
# GITHUB_CLIENT_ID
# GITHUB_CLIENT_SECRET
# JWT_SECRET_KEY

# Routes (optional - for custom domain)
# routes = [
#   { pattern = "api.example.com/*", zone_name = "example.com" }
# ]

# Limits
[limits]
cpu_ms = 50000  # 50 seconds CPU time
